收到，您强调了后端需要支持 **Web3D** 或 **UE (虚幻引擎)** 的对接。这意味着我们需要在架构上更明确地支持这两种渲染流的分发和管理。

我将调整计划，侧重于**后端对 3D 资产和流媒体服务的管理能力**，以及前端对这两种模式的自适应接入。

### 调整后的实施计划

#### 1. 3D 资产与流媒体管理 (后端核心升级)
*   **数据库扩展**:
    *   **`3d_assets` 表**: 专门管理 Web3D 模型文件（`.glb`, `.gltf`），记录文件大小、多边形数、适用场景等。
    *   **`ue_instances` 表**: 管理 UE 云渲染实例的信息（信令服务器地址、实例状态、当前负载）。
*   **API 升级 (`trpc` routers)**:
    *   `immersive.getAsset`: 获取 Web3D 模型下载链接。
    *   `immersive.connectUE`: 分配一个空闲的 UE 渲染实例，返回 WebSocket 连接地址（Pixel Streaming 信令地址）。

#### 2. 双模沉浸式引擎 (前端重构)
*   **Web3D 模式 (Three.js/R3F)**:
    *   **动态加载器**: 开发通用的 GLTF/GLB 加载器，从后端 `3d_assets` 获取模型并渲染，替代目前的硬编码几何体。
    *   **场景图谱**: 支持从后端获取场景配置（灯光、相机位置、热点坐标），在前端动态构建场景。
*   **UE 模式 (Pixel Streaming)**:
    *   **信令对接**: 实现标准的 Pixel Streaming 前端信令逻辑（不仅仅是 iframe），支持与 UE 后端的双向交互（如点击画面触发 UE 内的事件）。
    *   **降级策略**: 如果 UE 实例满载或连接失败，自动降级回 Web3D 模式。

#### 3. 口述历史与修复功能 (保持原计划但增强)
*   **口述历史**: 依然需要 `oral_histories` 表支持，但可以增加“3D 虚拟人讲述”的预留字段（关联到 UE 的 Metahuman 资产）。
*   **文物修复**: 实现 `ImageComparison` 组件，提升基础体验。

### 执行步骤
1.  **Schema 变更**: 创建 `3d_assets` 和 `ue_instances` 表，以及 `oral_histories` 表。
2.  **后端逻辑**: 实现资产管理和 UE 实例分配的模拟逻辑（因为没有真实的 UE 服务器，我们将模拟信令握手过程）。
3.  **前端引擎升级**:
    *   重写 `ImmersivePlayer`，分离 `Web3DRenderer` 和 `PixelStreamingClient`。
    *   实现动态场景加载。
4.  **业务功能补全**: 完成口述历史和文物修复的交互开发。

这个方案将后端定义为“3D 内容分发中心”，既能服务轻量级的 Web3D 请求，也能作为 UE 云渲染的调度层。